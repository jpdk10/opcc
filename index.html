<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPCC</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    
<script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <style>
        .scrolling-touch { -webkit-overflow-scrolling: touch; }
        .drag-over { border: 2px dashed #4a5568; }
        body { background-color: black; color: white; }
      
/* ROSSO + altri colori */
.combo-red-500-green-500 { background: linear-gradient(90deg, #ef4444 50%, #22c55e 50%); }
.combo-red-500-blue-500 { background: linear-gradient(90deg, #ef4444 50%, #3b82f6 50%); }
.combo-red-500-purple-500 { background: linear-gradient(90deg, #ef4444 50%, #a855f7 50%); }
.combo-red-500-gray-700 { background: linear-gradient(90deg, #ef4444 50%, #374151 50%); }
.combo-red-500-yellow-400 { background: linear-gradient(90deg, #ef4444 50%, #facc15 50%); }

/* VERDE + altri colori */
.combo-green-500-red-500 { background: linear-gradient(90deg, #22c55e 50%, #ef4444 50%); }
.combo-green-500-blue-500 { background: linear-gradient(90deg, #22c55e 50%, #3b82f6 50%); }
.combo-green-500-purple-500 { background: linear-gradient(90deg, #22c55e 50%, #a855f7 50%); }
.combo-green-500-gray-700 { background: linear-gradient(90deg, #22c55e 50%, #374151 50%); }
.combo-green-500-yellow-400 { background: linear-gradient(90deg, #22c55e 50%, #facc15 50%); }

/* AZZURRO + altri colori */
.combo-blue-500-red-500 { background: linear-gradient(90deg, #3b82f6 50%, #ef4444 50%); }
.combo-blue-500-green-500 { background: linear-gradient(90deg, #3b82f6 50%, #22c55e 50%); }
.combo-blue-500-purple-500 { background: linear-gradient(90deg, #3b82f6 50%, #a855f7 50%); }
.combo-blue-500-gray-700 { background: linear-gradient(90deg, #3b82f6 50%, #374151 50%); }
.combo-blue-500-yellow-400 { background: linear-gradient(90deg, #3b82f6 50%, #facc15 50%); }

/* VIOLA + altri colori */
.combo-purple-500-red-500 { background: linear-gradient(90deg, #a855f7 50%, #ef4444 50%); }
.combo-purple-500-green-500 { background: linear-gradient(90deg, #a855f7 50%, #22c55e 50%); }
.combo-purple-500-blue-500 { background: linear-gradient(90deg, #a855f7 50%, #3b82f6 50%); }
.combo-purple-500-gray-700 { background: linear-gradient(90deg, #a855f7 50%, #374151 50%); }
.combo-purple-500-yellow-400 { background: linear-gradient(90deg, #a855f7 50%, #facc15 50%); }

/* NERO + altri colori */
.combo-gray-700-red-500 { background: linear-gradient(90deg, #374151 50%, #ef4444 50%); }
.combo-gray-700-green-500 { background: linear-gradient(90deg, #374151 50%, #22c55e 50%); }
.combo-gray-700-blue-500 { background: linear-gradient(90deg, #374151 50%, #3b82f6 50%); }
.combo-gray-700-purple-500 { background: linear-gradient(90deg, #374151 50%, #a855f7 50%); }
.combo-gray-700-yellow-400 { background: linear-gradient(90deg, #374151 50%, #facc15 50%); }

/* GIALLO + altri colori */
.combo-yellow-400-red-500 { background: linear-gradient(90deg, #facc15 50%, #ef4444 50%); }
.combo-yellow-400-green-500 { background: linear-gradient(90deg, #facc15 50%, #22c55e 50%); }
.combo-yellow-400-blue-500 { background: linear-gradient(90deg, #facc15 50%, #3b82f6 50%); }
.combo-yellow-400-purple-500 { background: linear-gradient(90deg, #facc15 50%, #a855f7 50%); }
.combo-yellow-400-gray-700 { background: linear-gradient(90deg, #facc15 50%, #374151 50%); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">


       const initialSetOptions = [ 'ALL', 'OP01', 'OP02', 'OP03', 'OP04', 'OP05', 'OP06', 'OP07', 'OP08', 'OP09', 'OP10', 'OP11', 'OP12', 'OP13',  
        'EB01', 'EB02', 'PRB01', 'PRB02' , 'Promo', 'Unnumbered Promo', 'Judge Promo', 
        'Winner', 'Special Tournament', 'Pre-Release', 'Super Pre-Release'
    ];
        const versionOptions = ['V1', 'V2', 'V3'];
        const languageOptions = ['ENG', 'JAP', 'CHI', 'FRA'];
        const baseColors = [
    { name: 'ROSSO', value: 'bg-red-500', class: 'red-500' },
    { name: 'VERDE', value: 'bg-green-500', class: 'green-500' },
    { name: 'AZZURRO', value: 'bg-blue-500', class: 'blue-500' },
    { name: 'VIOLA', value: 'bg-purple-500', class: 'purple-500' },
    { name: 'NERO', value: 'bg-gray-700', class: 'gray-700' },
    { name: 'GIALLO', value: 'bg-yellow-400', class: 'yellow-400' }
];

// Genera tutte le combinazioni + colori singoli + special
const generateColorOptions = () => {
    const options = [];
    
    // Colori singoli
    baseColors.forEach(color => {
        options.push({
            name: color.name,
            value: color.value,
            isCombo: false
        });
    });
    
    // Combinazioni complete: ogni colore con tutti gli altri (A+B e B+A)
    baseColors.forEach((color1, i) => {
        baseColors.forEach((color2, j) => {
            if (i !== j) { // Escludi combinazioni di un colore con se stesso
                options.push({
                    name: `${color1.name}+${color2.name}`,
                    value: `combo-${color1.class}-${color2.class}`,
                    isCombo: true,
                    color1: color1.class,
                    color2: color2.class
                });
            }
        });
    });
    
    // Special sempre alla fine
    options.push({
        name: 'SPECIAL',
        value: 'bg-amber-800',
        isCombo: false
    });
    
    return options;
};

const colorOptions = generateColorOptions();

const CardForm = ({ card, onInputChange, onImageChange, onSubmit, onCancel, setOptions, onAddCustomSet }) => {
    const [isAddingCustomSet, setIsAddingCustomSet] = React.useState(false);
    const [customSet, setCustomSet] = React.useState('');
    const [imageLink, setImageLink] = React.useState('');
    const [previewImage, setPreviewImage] = React.useState(null);
    

    React.useEffect(() => {
        if (card.image) {
            setPreviewImage(card.image);
        }
    }, [card.image]);

    const handleSetChange = (e) => {
        const value = e.target.value;
        if (value === 'add_custom') {
            setIsAddingCustomSet(true);
        } else {
            onInputChange(e);
        }
    };

    const handleCustomSetSubmit = () => {
        if (customSet.trim() !== '') {
            onAddCustomSet(customSet.trim());
            onInputChange({ target: { name: 'set', value: customSet.trim() } });
            setIsAddingCustomSet(false);
            setCustomSet('');
        }
    };

    const handleImageLinkChange = (e) => {
        setImageLink(e.target.value);
    };

    const handleImageLinkSubmit = () => {
        if (imageLink.trim() !== '') {
            setPreviewImage(imageLink.trim());
            onImageChange({ target: { type: 'url', value: imageLink.trim() } });
            setImageLink('');
        }
    };

    const handleFileChange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                setPreviewImage(reader.result);
                onImageChange({ target: { type: 'file', value: reader.result } });
            };
            reader.readAsDataURL(file);
        }
    };

    const handleRemoveImage = () => {
        setPreviewImage(null);
        onImageChange({ target: { type: 'remove' } });
    };

   return (
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label className="block mb-1 text-white">Nome Carta</label>
                        <input
                            type="text"
                            name="name"
                            value={card.name}
                            onChange={onInputChange}
                            className="w-full px-3 py-2 border rounded text-black"
                            placeholder="Nome della carta"
                        />
                    </div>
                    <div>
                        <label className="block mb-1 text-white">Set</label>
                        {isAddingCustomSet ? (
                            <div className="flex">
                                <input
                                    type="text"
                                    value={customSet}
                                    onChange={(e) => setCustomSet(e.target.value)}
                                    className="w-full px-3 py-2 border rounded-l text-black"
                                    placeholder="Nuovo set"
                                />
                                <button
                                    onClick={handleCustomSetSubmit}
                                    className="px-4 py-2 bg-blue-500 text-white rounded-r hover:bg-blue-600"
                                >
                                    Aggiungi
                                </button>
                            </div>
                        ) : (
                          <select
            name="set"
            value={card.set}
            onChange={handleSetChange}
            className="w-full px-3 py-2 border rounded text-black"
          >
            <option value="">Seleziona un set</option>
            {setOptions.filter(set => set !== 'ALL').map((option) => (
              <option key={option} value={option}>
                {getSetIcon(option)} {option}
              </option>
            ))}
            <option value="add_custom">Aggiungi altro...</option>
          </select>
        )}
      </div>
      
      <div className="flex items-center mt-2">
    <input
        type="checkbox"
        id="isDon"
        name="isDon"
        checked={card.isDon}
        onChange={onInputChange}
        className="mr-2"
    />
    <label htmlFor="isDon" className="text-white">DON!!</label>
</div>
                <div>
                    <label className="block mb-1 text-white">Numero Carta</label>
                    <input
                        type="text"
                        name="cardNumber"
                        value={card.cardNumber}
                        onChange={onInputChange}
                        className="w-full px-3 py-2 border rounded text-black"
                        placeholder="Numero della carta"
                    />
                </div>
                <div>
    <label className="block mb-1 text-white">Set Originale (opzionale)</label>
    <input
        type="text"
        name="ogSet"
        value={card.ogSet}
        onChange={onInputChange}
        className="w-full px-3 py-2 border rounded text-black"
        placeholder="Set originale"
    />
</div>
<div>
    <label className="block mb-1 text-white">Numero Carta Originale (opzionale)</label>
    <input
        type="text"
        name="ogCardNumber"
        value={card.ogCardNumber}
        onChange={onInputChange}
        className="w-full px-3 py-2 border rounded text-black"
        placeholder="Numero carta originale"
    />
</div>
                <div>
                    <label className="block mb-1 text-white">Versione</label>
                    <select
                        name="version"
                        value={card.version}
                        onChange={onInputChange}
                        className="w-full px-3 py-2 border rounded text-black"
                    >
                        <option value="">Seleziona una versione</option>
                        {versionOptions.map((option) => (
                            <option key={option} value={option}>{option}</option>
                        ))}
                    </select>
                </div>
                <div>
                    <label className="block mb-1 text-white">Lingua</label>
                    <select
                        name="language"
                        value={card.language}
                        onChange={onInputChange}
                        className="w-full px-3 py-2 border rounded text-black"
                    >
                        {languageOptions.map((option) => (
                            <option key={option} value={option}>{option}</option>
                        ))}
                    </select>
                </div>
               <div className="col-span-1 sm:col-span-2">
                <label className="block mb-1 text-white">Immagine Carta</label>
                <div className="flex flex-col sm:flex-row items-center gap-4">
                    <div className="flex-1 w-full">
                        <input
                            type="file"
                            onChange={handleFileChange}
                            className="w-full px-3 py-2 border rounded text-white"
                            accept="image/*"
                        />
                    </div>
                    <div className="flex-1 w-full">
                        <div className="flex">
                            <input
                                type="text"
                                value={imageLink}
                                onChange={handleImageLinkChange}
                                className="w-full px-3 py-2 border rounded-l text-black"
                                placeholder="Incolla il link dell'immagine"
                            />
                            <button
                                onClick={handleImageLinkSubmit}
                                className="px-4 py-2 bg-blue-500 text-white rounded-r hover:bg-blue-600"
                            >
                                Aggiungi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {previewImage && (
                <div className="col-span-1 sm:col-span-2 mt-4 flex items-center">
                    <div className="relative w-24 h-24 mr-4">
                        <img
                            src={previewImage}
                            alt="Anteprima"
                            className="absolute top-0 left-0 w-full h-full object-cover border rounded"
                        />
                        <button
                            onClick={handleRemoveImage}
                            className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 text-xs"
                            style={{ width: '20px', height: '20px', lineHeight: '1' }}
                        >
                            ‚úï
                        </button>
                    </div>
                    <span className="text-white text-sm">Immagine selezionata</span>
                </div>
            )}
              <div className="flex items-center">
    <input
        type="checkbox"
        id="special"
        name="special"
        checked={card.special}
        onChange={onInputChange}
        className="mr-2"
    />
    <label htmlFor="special" className="text-white mr-4">Special</label>

    <input
        type="checkbox"
        id="favorite"
        name="favorite"
        checked={card.favorite}
        onChange={onInputChange}
        className="mr-2"
    />
    <label htmlFor="favorite" className="text-white flex items-center">
        Preferiti <span className="ml-1">‚≠ê</span>
    </label>
</div>

                <div className="col-span-1 sm:col-span-2">
    <label className="block mb-1 text-white">Note</label>
    <textarea
        name="notes"
        value={card.notes}
        onChange={onInputChange}
        className="w-full px-3 py-2 border rounded text-black"
        placeholder="Inserisci eventuali note sulla carta"
        rows="3"
    />
</div>
                <div>
    <label className="block mb-1 text-white">Colore</label>
    <div className="grid grid-cols-6 gap-2 max-h-32 overflow-y-auto">
        {colorOptions.map((color) => (
            <button
                key={color.value}
                className={`w-8 h-8 rounded-full ${color.isCombo ? '' : color.value} ${color.isCombo ? color.value : ''} ${card.color === color.value ? 'ring-2 ring-offset-2 ring-white' : ''}`}
                style={color.isCombo ? {} : {}}
                onClick={() => onInputChange({ target: { name: 'color', value: color.value } })}
                title={color.name}
            />
        ))}
    </div>
</div>
                    <div className="col-span-1 sm:col-span-2 flex justify-end space-x-2">
                        <button onClick={onCancel} className="px-4 py-2 bg-gray-500 text-white rounded">Annulla</button>
                        <button onClick={onSubmit} className="px-4 py-2 bg-blue-500 text-white rounded">
                            {card.id ? 'Aggiorna' : 'Aggiungi'}
                        </button>
                    </div>
                </div>
            );
        };

        const ExportDialog = ({ isOpen, onClose, onExport }) => {
            const [fileName, setFileName] = React.useState('');

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
                
                    <div className="bg-gray-800 p-6 rounded-lg w-full max-w-md">
                        <h2 className="text-xl font-bold mb-4">Esporta Collezione</h2>
                        <input
                            type="text"
                            value={fileName}
                            onChange={(e) => setFileName(e.target.value)}
                            placeholder="Nome del file (senza estensione)"
                            className="w-full px-3 py-2 mb-4 border rounded text-black"
                        />
                        <div className="flex justify-end space-x-2">
                            <button
                                onClick={onClose}
                                className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
                            >
                                Annulla
                            </button>
                            <button
                                onClick={() => onExport(fileName)}
                                className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                            >
                                Esporta
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        
        const PrintDialog = ({ isOpen, onClose, sets, selectedSets, onSetToggle, onPrint }) => {
    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50">
            <div className="bg-slate-900 border-2 border-gray-400 p-6 rounded-lg w-full max-w-md">
                <h2 className="text-xl font-bold mb-4">Seleziona i Set da Stampare</h2>
                <div className="mb-4 max-h-60 overflow-y-auto">
                    {sets.map(set => (
                        <label key={set} className="flex items-center mb-2">
                            <input
                                type="checkbox"
                                checked={selectedSets.includes(set)}
                                onChange={() => onSetToggle(set)}
                                className="mr-2"
                            />
                            {set}
                        </label>
                    ))}
                </div>
                <div className="flex justify-end space-x-2">
                    <button onClick={onClose} className="px-4 py-2 bg-red-500 rounded">Annulla</button>
                    <button onClick={onPrint} className="px-4 py-2 bg-green-500 text-white rounded">Stampa</button>
                </div>
            </div>
        </div>
    );
};

        

const getSetIcon = (set) => {
  if (['OP01', 'OP02', 'OP03', 'OP04', 'OP05', 'OP06', 'OP07', 'OP08', 'OP09', 'OP10', 'OP11', 'OP12', 'OP13', 'EB01', 'EB02', 'PRB01', 'PRB02'].includes(set)) {
    return 'üî¥'; // Icona rossa
  } else if (set.startsWith('ST')) {
    return 'üîµ'; // Icona blu
  } else if (['Promo', 'Unnumbered Promo', 'Judge Promo', 'Winner', 'Special Tournament', 'Pre-Release', 'Super Pre-Release'].includes(set)) {
    return '‚ö™'; // Icona pallino bianco
  }
  return '';
};

const CardDetailPopup = ({ card, onClose, onSave }) => {
  const [notes, setNotes] = useState(card.notes || '');

  const handleSave = () => {
    onSave({ ...card, notes });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
      <div className="bg-gray-800 p-6 rounded-lg w-full max-w-2xl">
        <h2 className="text-2xl font-bold mb-4 text-white">{card.name}</h2>
        <div className="grid grid-cols-2 gap-4 mb-4">
          <p className="text-white"><strong>Set:</strong> {card.set}</p>
          <p className="text-white"><strong>Numero:</strong> {card.cardNumber}</p>
          <p className="text-white"><strong>Versione:</strong> {card.version}</p>
          <p className="text-white"><strong>Lingua:</strong> {card.language}</p>
          <p className="text-white"><strong>Mancante:</strong> {card.missing ? 'S√¨' : 'No'}</p>
          <div className={`w-8 h-8 rounded-full ${card.color}`}></div>
        </div>
        {card.image && (
          <img src={card.image} alt={card.name} className="w-full max-h-64 object-contain mb-4" />
        )}
        <div className="mb-4">
          <label className="block text-white mb-2">Note:</label>
          <textarea
            value={notes}
            onChange={(e) => setNotes(e.target.value)}
            className="w-full px-3 py-2 text-black rounded"
            rows="4"
          ></textarea>
        </div>
        <div className="flex justify-end space-x-2">
          <button onClick={onClose} className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
            Chiudi
          </button>
          <button onClick={handleSave} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
            Salva
          </button>
        </div>
      </div>
    </div>
  );
};


const Preloader = () => {
    return (
        <div className="fixed inset-0 bg-black flex flex-col items-center justify-center z-50">
            <div className="mb-8">
                <img 
                    src="https://raw.githubusercontent.com/jpdk10/opcc/refs/heads/main/logo_opcc.PNG" 
                    alt="OPCC Logo" 
                    className="w-32 h-32 object-contain"
                />
            </div>
            <h2 className="text-white text-2xl font-bold">Benvenuto</h2>
        </div>
    );
};



      const CardCollectionApp = () => {
        const [isFullscreen, setIsFullscreen] = React.useState(false);

const toggleFullscreen = () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch((e) => {
      console.error(`Error attempting to enable full-screen mode: ${e.message}`);
    });
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
};
React.useEffect(() => {
  const handleFullscreenChange = () => {
    setIsFullscreen(!!document.fullscreenElement);
  };

  document.addEventListener('fullscreenchange', handleFullscreenChange);
  return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);
}, []);

// Picture-in-Picture functionality
const pipCanvasRef = React.useRef(null);
const pipIntervalRef = React.useRef(null);

const togglePictureInPicture = async () => {
  try {
    if (document.pictureInPictureElement) {
      await document.exitPictureInPicture();
      if (pipIntervalRef.current) {
        clearInterval(pipIntervalRef.current);
      }
      return;
    }

    // Verifica supporto PiP
    if (!document.pictureInPictureEnabled) {
      alert('Picture-in-Picture non √® supportato su questo browser.');
      return;
    }

    // Crea un canvas per il PiP
    const canvas = document.createElement('canvas');
    canvas.width = 800;
    canvas.height = 600;
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    // Crea il video per il PiP
    const video = document.createElement('video');
    video.muted = true;
    video.playsInline = true;
    video.autoplay = true;
    
    // Verifica che captureStream sia supportato
    if (!canvas.captureStream) {
      alert('captureStream non supportato. Usa Chrome o Edge.');
      return;
    }

    const stream = canvas.captureStream(30); // 30 FPS
    video.srcObject = stream;
    
    // Funzione per catturare e disegnare il contenuto
    const updatePiP = async () => {
      try {
        const root = document.getElementById('root');
        if (!root) return;

        // Disegna sfondo
        ctx.fillStyle = '#000000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Cattura con html2canvas
        const screenshot = await html2canvas(root, {
          scale: 0.3,
          logging: false,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#000000',
          removeContainer: true
        });
        
        // Calcola dimensioni proporzionate
        const scale = Math.min(
          canvas.width / screenshot.width,
          canvas.height / screenshot.height
        );
        const w = screenshot.width * scale;
        const h = screenshot.height * scale;
        const x = (canvas.width - w) / 2;
        const y = (canvas.height - h) / 2;
        
        ctx.drawImage(screenshot, x, y, w, h);
        
      } catch (error) {
        console.error('Errore aggiornamento PiP:', error);
      }
    };

    // Prima cattura
    await updatePiP();
    
    // Aspetta che il video sia pronto
    await video.play();
    
    // Avvia il PiP
    await video.requestPictureInPicture();
    
    // Aggiorna ogni secondo (pi√π veloce causa lag)
    pipIntervalRef.current = setInterval(updatePiP, 1000);

    // Gestisci chiusura PiP
    video.addEventListener('leavepictureinpicture', () => {
      if (pipIntervalRef.current) {
        clearInterval(pipIntervalRef.current);
      }
    }, { once: true });

  } catch (error) {
    console.error('Errore PiP:', error);
    alert('Errore nell\'attivare Picture-in-Picture: ' + error.message);
  }
};

const openPopupWindow = () => {
  const width = 800;
  const height = 600;
  const left = window.screen.width - width - 20;
  const top = 20;
  
  const popupWindow = window.open(
    window.location.href,
    'OPCC_Popup',
    `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,status=no,alwaysRaised=yes`
  );
  
  if (popupWindow) {
    popupWindow.focus();
  } else {
    alert('Popup bloccato! Abilita i popup per questo sito.');
  }
};

        const [utilityPopupVisible, setUtilityPopupVisible] = React.useState(false);
const [shopPopupVisible, setShopPopupVisible] = React.useState(false);
const [comingSoonPopupVisible, setComingSoonPopupVisible] = React.useState(false);

        const [linkCopied, setLinkCopied] = React.useState(false);
        const [utilityVisible, setUtilityVisible] = React.useState(false);
        const [shopVisible, setShopVisible] = React.useState(false);

        const [isMenuVisible, setIsMenuVisible] = React.useState(false);

          
const selectedCollection = 'OP Card Collection';
const [theme, setTheme] = React.useState('standard');
const toggleTheme = () => {
    setTheme(prevTheme => prevTheme === 'standard' ? 'pink' : 'standard');
};
  const [selectedCard, setSelectedCard] = React.useState(null);
      const [currentPage, setCurrentPage] = React.useState(1);
    const cardsPerPage = 20; // Numero di carte per pagina
    const [cards, setCards] = React.useState([]);
const [newCard, setNewCard] = React.useState({
    id: null,
    name: '',
    set: '',
    cardNumber: '',
    version: '',
    language: 'ENG',
    image: null,
    color: '',
    notes: '',
    special: false,
    favorite: false,
    ogSet: '',
    ogCardNumber: '',
    isDon: false
});
    const [isEditDialogOpen, setIsEditDialogOpen] = React.useState(false);
    const [activeSet, setActiveSet] = React.useState('ALL');
    const [searchTerm, setSearchTerm] = React.useState('');
    const [isFormVisible, setIsFormVisible] = React.useState(false);
    const [setOptions, setSetOptions] = React.useState(initialSetOptions);
    const [loadedFileName, setLoadedFileName] = React.useState(null);
    const [isExportDialogOpen, setIsExportDialogOpen] = React.useState(false);
    const [isPrintDialogOpen, setIsPrintDialogOpen] = React.useState(false);
const [selectedSetsToPrint, setSelectedSetsToPrint] = React.useState([]);
    


    
  
    const [showFavoritesOnly, setShowFavoritesOnly] = React.useState(false);
    const [showSpecialOnly, setShowSpecialOnly] = React.useState(false);
    
    const [isSignedIn, setIsSignedIn] = React.useState(false);
           const [tokenClient, setTokenClient] = React.useState(null);

          const [shopFormData, setShopFormData] = React.useState({
    carta: '',
    set: '',
    numero: ''
});
          const [viewMode, setViewMode] = React.useState('grid'); // 'grid' o 'list'

        
          const handleShopFormChange = (e) => {
    const { name, value } = e.target;
    setShopFormData(prev => ({ ...prev, [name]: value }));
};

const handleShopSearch = (e) => {
    e.preventDefault();
    const { carta, set, numero } = shopFormData;
    
    if (!carta.trim()) {
        alert('Inserisci almeno il nome della carta');
        return;
    }
    
    // Costruire la query di ricerca
    let searchQuery = carta.trim();
    if (set.trim()) {
        searchQuery += ` ${set.trim()}`;
    }
    if (numero.trim()) {
        searchQuery += ` ${numero.trim()}`;
    }
    searchQuery += ' card market';
    
    // Aprire Google in una nuova scheda
    const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
    window.open(googleSearchUrl, '_blank');
    
    // Reset del form
    setShopFormData({
        carta: '',
        set: '',
        numero: ''
    });
    
    // Chiudere il popup
    setShopPopupVisible(false);
};

const resetShopForm = () => {
    setShopFormData({
        carta: '',
        set: '',
        numero: ''
    });
};

          
const clearCache = () => {
    localStorage.removeItem('cardCollection');
    localStorage.removeItem('customSets');
    setCards([]);
    setSetOptions(initialSetOptions);
    setLoadedFileName(null);
    alert('Cache cancellata. La pagina verr√† ricaricata.');
    window.location.reload();
};


 
  
  
    function handleAuthClick() {
        if (tokenClient) {
            tokenClient.requestAccessToken({prompt: ''});
        } else {
            console.error('Token client not initialized');
        }
    }
function handleSignoutClick() {
    if (tokenClient && google.accounts.oauth2.hasGrantedAnyScope(tokenClient)) {
        google.accounts.oauth2.revoke(tokenClient.getAccessToken(), () => {
            setIsSignedIn(false);
            console.log('Token revoked');
        });
    }
}



React.useEffect(() => {
}, []);
  
const generateCollectionLink = () => {
  const baseUrl = window.location.origin + window.location.pathname;
  return baseUrl;
};

const copyLinkToClipboard = () => {
  const link = generateCollectionLink();
  navigator.clipboard.writeText(link).then(() => {
    setLinkCopied(true);
    setTimeout(() => setLinkCopied(false), 2000);
  }).catch(err => {
    console.error('Errore nel copiare il link: ', err);
  });
};

              React.useEffect(() => {
        if (!Array.isArray(cards)) {
            setCards([]);
        }
    }, [cards]);
          
React.useEffect(() => {
    const script = document.createElement('script');
    script.src = 'https://accounts.google.com/gsi/client';
    script.onload = initClient;
    script.async = true;
    script.defer = true;
    document.body.appendChild(script);

    return () => {
        document.body.removeChild(script);
    };
}, []);



const CLIENT_ID = '69632141194-vhq4hbrf2607s0g044m8tg2cv8t19cdv.apps.googleusercontent.com';
const API_KEY = 'AIzaSyC4BQ_fAHJSxGjk-aPyBcRI27ESbx5_-bE';
const SCOPES = 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile openid https://www.googleapis.com/auth/spreadsheets';
const DISCOVERY_DOCS = ['https://sheets.googleapis.com/$discovery/rest?version=v4'];
const REDIRECT_URI = 'https://jpdk10.github.io/opcc/';

function initClient() {
    const tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (response) => {
            if (response.error !== undefined) {
                console.error(response);
                return;
            }
            setIsSignedIn(true);
            console.log('OAuth Token acquired');
        },
    });
    setTokenClient(tokenClient);
}



function updateSigninStatus(isSignedIn) {
    setIsSignedIn(isSignedIn);
}





async function saveToGoogleSheets() {
    if (!tokenClient) {
        console.error('Token client not initialized');
        return;
    }

    try {
        const token = await new Promise((resolve, reject) => {
            tokenClient.callback = (response) => {
                if (response.error !== undefined) {
                    reject(response);
                }
                resolve(response.access_token);
            };
            tokenClient.requestAccessToken({prompt: ''});
        });

        const spreadsheetId = '13fqpfjx91d6Ke99LVIofbTZr_goA8dQdmNUPTPjcDsQ';
       const range = 'Andrea!A2:O';


const values = cards.map(card => [
    card.id,
    card.name,
    card.set,
    card.cardNumber,
    card.version,
    card.language,
    card.image,
    card.color,
    card.notes,
    card.special ? 'Yes' : 'No',  // AGGIUNGERE QUESTA RIGA
    card.favorite ? 'Yes' : 'No',
    card.ogSet,
    card.ogCardNumber,
    card.isDon ? 'Yes' : 'No'
]);

      console.log('Attempting to save to Google Sheets...');
        console.log('Token:', token);
        console.log('Spreadsheet ID:', spreadsheetId);
        console.log('Range:', range);
        console.log('Values:', values);

        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?valueInputOption=USER_ENTERED`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ values: values })
        });

        if (!response.ok) {
            const errorText = await response.text();
            console.error('Response not OK. Status:', response.status);
            console.error('Response text:', errorText);
            throw new Error(`Failed to save to Google Sheets: ${response.status} ${errorText}`);
        }

        const responseData = await response.json();
        console.log('Save successful. Response:', responseData);

    } catch (error) {
        console.error('Detailed error in saving to Google Sheets:', error);
        if (error.response) {
            const errorText = await error.response.text();
            console.error('Error response text:', errorText);
        }
        throw error; // Rethrow the error so it can be caught by the caller
    }
}

async function loadFromGoogleSheets() {
    if (!tokenClient) {
        console.error('Token client not initialized');
        return;
    }

    try {
        const token = await new Promise((resolve, reject) => {
            tokenClient.callback = (response) => {
                if (response.error !== undefined) {
                    reject(response);
                }
                resolve(response.access_token);
            };
            tokenClient.requestAccessToken({prompt: ''});
        });

        const spreadsheetId = '13fqpfjx91d6Ke99LVIofbTZr_goA8dQdmNUPTPjcDsQ';
const range = 'Andrea!A1:O'
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (!response.ok) {
            throw new Error('Failed to load from Google Sheets');
        }

        const data = await response.json();
        console.log('Raw data from Google Sheets:', data.values);

const loadedCards = data.values.slice(1).map((row, index) => ({
     id: row[0] || `${Date.now()}-${index}`,
    name: row[1] || '',
    set: row[2] || '',
    cardNumber: row[3] || '',
    version: row[4] || '',
    language: row[5] || 'ENG',
    image: row[6] || null,
    color: row[7] || '',
    notes: row[8] || '',
    special: row[9] === 'Yes',  // AGGIUNGERE QUESTA RIGA
    favorite: row[10] === 'Yes',  // AGGIORNARE INDICE da 9 a 10
    ogSet: row[11] || '',  // AGGIORNARE INDICE da 10 a 11
    ogCardNumber: row[12] || '',  // AGGIORNARE INDICE da 11 a 12
    isDon: row[13] === 'Yes'  // AGGIORNARE INDICE da 12 a 13
}));

        console.log('Loaded cards:', loadedCards);

        setCards(loadedCards);
        console.log('Data loaded from Google Sheets');
    } catch (error) {
        console.error('Error loading from Google Sheets:', error);
    }
}




 

    
    React.useEffect(() => {
    document.body.style.backgroundColor = theme === 'standard' ? 'black' : '#FFC0CB';
}, [theme]);
    
 React.useEffect(() => {
    const handleKeyPress = (event) => {
        if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
            return;
        }

        switch (event.key.toLowerCase()) {
            case 'n':
                setIsFormVisible(true);
                break;
            case 'l':
                document.getElementById('excelUpload').click();
                break;
            default:
                break;
        }
    };

    window.addEventListener('keydown', handleKeyPress);

    return () => {
        window.removeEventListener('keydown', handleKeyPress);
    };
}, []);
    
    

            const handleFileUpload = (event) => {
              const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        const formattedCards = jsonData.map(card => ({
                            id: card.id || Date.now(),
                            name: card.name || '',
                            set: card.set || '',
                            cardNumber: card.cardNumber || '',
                            version: card.version || '',
                            language: card.language || 'ENG',
                            image: card.image || null,
                            missing: card.missing || false,
                            color: card.color || ''
                        }));

                       setCards(formattedCards);
  saveToGoogleSheets(); // Aggiungi questa riga
                        
                        // Update setOptions with any new sets from the Excel file
                        const newSets = [...new Set(formattedCards.map(card => card.set))];
                        setSetOptions(prevSets => [...new Set([...prevSets, ...newSets])]);

                        setLoadedFileName(file.name);
                    };
                    reader.readAsArrayBuffer(file);
                }
            };

            const handleExcelExport = (fileName) => {
                const worksheet = XLSX.utils.json_to_sheet(cards);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Cards");
                XLSX.writeFile(workbook, `${fileName || 'card_collection'}.xlsx`);
                setIsExportDialogOpen(false);
            };
            
            const togglePrintDialog = () => setIsPrintDialogOpen(!isPrintDialogOpen);

const handleSetSelection = (set) => {
    setSelectedSetsToPrint(prev => 
        prev.includes(set) ? prev.filter(s => s !== set) : [...prev, set]
    );
};

const generatePrintableCards = () => {
    return cards.filter(card => 
        selectedSetsToPrint.includes(card.set)
    ).map(card => ({
        name: card.name,
        set: card.set,
        number: card.cardNumber,
        version: card.version
    }));
};

const handlePrint = () => {
    const cardsToprint = generatePrintableCards();
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
            <head>
                <title>Carte Collezione</title>
                <style>
                    table { border-collapse: collapse; width: 100%; }
                    th, td { border: 1px solid black; padding: 8px; text-align: left; }
                    th { background-color: #f2f2f2; }
                </style>
            </head>
            <body>
                <h1>Carte Collezione - Set Selezionati</h1>
                <table>
                    <thead>
                        <tr>
                            <th>Nome Carta</th>
                            <th>Set</th>
                            <th>Numero</th>
                            <th>Versione</th>
                            <th>Prezzo</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${cardsToprint.map(card => `
                            <tr>
                                <td>${card.name}</td>
                                <td>${card.set}</td>
                                <td>${card.number}</td>
                                <td>${card.version}</td>
                                <td></td>
                                <td></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
};

            const handleFileEject = () => {
                 setCards([]);
                setSetOptions(initialSetOptions);
                setLoadedFileName(null);
            };

          React.useEffect(() => {
                const savedCards = localStorage.getItem('cardCollection');
                const savedSets = localStorage.getItem('customSets');
                if (savedCards) {
                    setCards(JSON.parse(savedCards));
                }
                if (savedSets) {
                    setSetOptions([...initialSetOptions, ...JSON.parse(savedSets)]);
                }
            }, []);

            React.useEffect(() => {
                localStorage.setItem('cardCollection', JSON.stringify(cards));
            }, [cards]);

            React.useEffect(() => {
                const customSets = setOptions.filter(set => !initialSetOptions.includes(set));
                localStorage.setItem('customSets', JSON.stringify(customSets));
            }, [setOptions]);
            
      React.useEffect(() => {
  // Removed collection dependency since selector is removed
}, []);

React.useEffect(() => {
    // Simula il caricamento iniziale
    const timer = setTimeout(() => {
        setIsLoading(false);
    }, 2000); // 2 secondi di preloader

    return () => clearTimeout(timer);
}, []);


            const handleInputChange = (e) => {
                const { name, value, type, checked } = e.target;
                setNewCard(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
            };

       const handleImageChange = (e) => {
        if (e.target.type === 'file' || e.target.type === 'url') {
            setNewCard(prev => ({ ...prev, image: e.target.value }));
        } else if (e.target.type === 'remove') {
            setNewCard(prev => ({ ...prev, image: null }));
        }
    };



     // Modifica la funzione di ordinamento
   const addOrUpdateCard = () => {
    if (newCard.name.trim() !== '') {
        let updatedCards;
        if (newCard.id) {
            updatedCards = cards.map(card => card.id === newCard.id ? newCard : card);
        } else {
            // Genera un ID unico basato sul timestamp e un numero casuale
            const uniqueId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            updatedCards = [...cards, { ...newCard, id: uniqueId }];
        }
      
        // Definire l'ordine dei set
             const setOrder = [
                'OP01', 'OP02', 'OP03', 'OP04', 'OP05', 'OP06', 'OP07', 'OP08', 'OP09', 'OP10', 'OP11', 'OP12', 'OP13',  
                'EB01', 'EB02', 'PRB01', 'PRB02' ,  
                'Promo', 'Unnumbered Promo', 'Judge Promo', 'Winner', 'Special Tournament', 'Pre-Release', 'Super Pre-Release'
            ];

           const versionOrder = ['V1', 'V2', 'V3'];
updatedCards.sort((a, b) => {
    // 1. Ordinare per set
    const setOrderDiff = setOrder.indexOf(a.set) - setOrder.indexOf(b.set);
    if (setOrderDiff !== 0) return setOrderDiff;

    // 2. Se una delle due √® una carta DON!!, metterla dopo
    if (a.isDon && !b.isDon) return 1;
    if (!a.isDon && b.isDon) return -1;

    // Se entrambe sono DON!!, ordina per numero carta
    if (a.isDon && b.isDon) {
        return parseInt(a.cardNumber) - parseInt(b.cardNumber);
    }

    // 3. Se stesso set e non sono DON!!, ordinare per versione
    const versionOrderDiff = versionOrder.indexOf(a.version) - versionOrder.indexOf(b.version);
    if (versionOrderDiff !== 0) return versionOrderDiff;

    // 4. Se stesso colore, ordinare per numero carta
    if (!a.ogSet && !b.ogSet) {
        return parseInt(a.cardNumber) - parseInt(b.cardNumber);
    }

    // 5. Se una delle due √® una carta speciale (ha ogSet), metterla dopo
    if (a.ogSet && !b.ogSet) return 1;
    if (!a.ogSet && b.ogSet) return -1;

    // 6. Se entrambe sono speciali, ordinare per ogSet e ogCardNumber
    if (a.ogSet && b.ogSet) {
        const ogSetOrderDiff = setOrder.indexOf(a.ogSet) - setOrder.indexOf(b.ogSet);
        if (ogSetOrderDiff !== 0) return ogSetOrderDiff;
        return parseInt(a.ogCardNumber) - parseInt(b.ogCardNumber);
    }

    return 0;
});
    
        
      setCards(updatedCards);
        saveToGoogleSheets();
setNewCard({
    id: null,
    name: '',
    set: '',
    cardNumber: '',
    version: '',
    language: 'ENG',
    image: null,
    color: '',
    notes: '',
    special: false,
    favorite: false,
    ogSet: '',
    ogCardNumber: '',
    isDon: false,
});
        setIsEditDialogOpen(false);
        setIsFormVisible(false);
    }
};

                    
       

            const editCard = (card) => {
                setNewCard(card);
                setIsEditDialogOpen(true);
            };

            const deleteCard = (id) => {
                setCards(cards.filter(card => card.id !== id));
saveToGoogleSheets(); // Aggiungi questa riga
            };

            const addCustomSet = (newSet) => {
                if (!setOptions.includes(newSet)) {
                    setSetOptions(prev => [...prev, newSet]);
                }
            };
            
              const getFlagEmoji = (language) => {
                switch (language) {
                    case 'JAP': return 'üáØüáµ';
                    case 'CHI': return 'üá®üá≥';
                    case 'FRA': return 'üá´üá∑';
                    default: return '';
                }
            };
            
const filteredCards = Array.isArray(cards) ? cards.filter(card => 
    (activeSet === 'ALL' || card.set === activeSet) &&
    ((card.name && card.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
     (card.cardNumber && card.cardNumber.toLowerCase().includes(searchTerm.toLowerCase()))) &&
    (!showSpecialOnly || card.special) &&
    (!showFavoritesOnly || card.favorite)
) : [];

    const indexOfLastCard = currentPage * cardsPerPage;
    const indexOfFirstCard = indexOfLastCard - cardsPerPage;
    const currentCards = filteredCards.slice(indexOfFirstCard, indexOfLastCard);
    const totalPages = Math.ceil(filteredCards.length / cardsPerPage);

    const paginate = (pageNumber) => setCurrentPage(pageNumber);

 const CardGrid = ({ cards, onCardClick, onEditCard, onDeleteCard }) => (
    <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        {Array.isArray(cards) && cards.map((card) => (
       
<div 
    key={card.id}
    className={`relative ${card.isDon ? 'bg-white' : (card.color.startsWith('combo-') ? card.color : card.color)} rounded-lg shadow-md overflow-hidden group transition-all duration-300 ease-in-out flex flex-col cursor-pointer`}
    onClick={() => onCardClick(card)}
>
                <div className="relative pt-[100%] w-full mt-4">
                    {card.image && (
                        <img 
                            src={card.image} 
                            alt={card.name} 
                            className="absolute top-0 left-0 w-full h-full object-contain"
                        />
                    )}
                </div>
                <div className="p-4 flex-grow">
                    <h3 className={`font-bold text-lg mb-2 ${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                        {card.name.toUpperCase()} ({card.version}) {getFlagEmoji(card.language)}
                    </h3>
                    <p className={`text-sm ${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
    ({card.set} - {card.cardNumber})
    {card.ogSet && ` (OG: ${card.ogSet} - ${card.ogCardNumber})`}
      {card.isDon && (
        <span className="absolute top-2 left-2 bg-yellow-400 text-black px-2 py-1 rounded-full text-xs font-bold">
            DON!!
        </span>
    )}
</p>
                </div>
              
                     <div className="absolute top-2 right-2 p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black bg-opacity-50 z-20">
                    <button 
                        onClick={(e) => {
                            e.stopPropagation();
                            onEditCard(card);
                        }} 
                        className="text-white mr-2 hover:text-blue-300 text-shadow"
                    >
                        Edit
                    </button>
                    <button 
                        onClick={(e) => {
                            e.stopPropagation();
                            onDeleteCard(card.id);
                        }} 
                        className="text-white hover:text-red-300 text-shadow"
                    >
                        Delete
                    </button>
                </div>
            </div>
        ))}
    </div>
);
          const CardList = ({ cards, onCardClick, onEditCard, onDeleteCard }) => (
    <div className="space-y-4">
        {Array.isArray(cards) && cards.map((card) => (
            <div 
                key={card.id}
                className={`relative ${card.isDon ? 'bg-white' : card.color} rounded-lg shadow-md overflow-hidden group transition-all duration-300 ease-in-out flex cursor-pointer p-4`}
                onClick={() => onCardClick(card)}
            >
   
                <div className="flex-shrink-0 w-20 h-28 mr-4">
                    {card.image ? (
                        <img 
                            src={card.image} 
                            alt={card.name} 
                            className="w-full h-full object-contain rounded"
                        />
                    ) : (
                        <div className="w-full h-full bg-gray-300 rounded flex items-center justify-center">
                            <span className="text-xs text-gray-600">No Image</span>
                        </div>
                    )}
                </div>

           
                <div className="flex-grow">
                    <div className="flex justify-between items-start mb-2">
                        <h3 className={`font-bold text-lg ${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            {card.name.toUpperCase()} ({card.version}) {getFlagEmoji(card.language)}
                        </h3>
                        {card.isDon && (
                            <span className="bg-yellow-400 text-black px-2 py-1 rounded-full text-xs font-bold ml-2">
                                DON!!
                            </span>
                        )}
                    </div>
                    
                    <div className="grid grid-cols-2 gap-2 text-sm">
                        <p className={`${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            <span className="font-semibold">Set:</span> {card.set}
                        </p>
                        <p className={`${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            <span className="font-semibold">Numero:</span> {card.cardNumber}
                        </p>
                        <p className={`${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            <span className="font-semibold">Lingua:</span> {card.language}
                        </p>
                        <p className={`${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            <span className="font-semibold">Preferito:</span> {card.favorite ? '‚≠ê' : 'No'}
                        </p>
                    </div>

                    {card.ogSet && (
                        <p className={`text-sm mt-1 ${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            <span className="font-semibold">Originale:</span> {card.ogSet} - {card.ogCardNumber}
                        </p>
                    )}

                    {card.notes && (
                        <p className={`text-sm mt-2 ${card.isDon ? 'text-black' : 'text-white'} ${!card.isDon && 'text-shadow'}`}>
                            <span className="font-semibold">Note:</span> {card.notes}
                        </p>
                    )}
                </div>

  
                <div className="absolute top-2 right-2 p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black bg-opacity-50 z-20">
                    <button 
                        onClick={(e) => {
                            e.stopPropagation();
                            onEditCard(card);
                        }} 
                        className="text-white mr-2 hover:text-blue-300 text-shadow"
                    >
                        Edit
                    </button>
                    <button 
                        onClick={(e) => {
                            e.stopPropagation();
                            onDeleteCard(card.id);
                        }} 
                        className="text-white hover:text-red-300 text-shadow"
                    >
                        Delete
                    </button>
                </div>
            </div>
        ))}
    </div>

);


  const Pagination = ({ currentPage, totalPages, paginate }) => {
    const [jumpToPage, setJumpToPage] = React.useState('');
    const pageNumbers = [];
    const maxPagesToShow = 5;

    // Logica per generare i numeri di pagina (come prima)
    if (totalPages <= maxPagesToShow) {
        for (let i = 1; i <= totalPages; i++) {
            pageNumbers.push(i);
        }
    } else {
        if (currentPage <= 3) {
            for (let i = 1; i <= 5; i++) {
                pageNumbers.push(i);
            }
            pageNumbers.push('...');
            pageNumbers.push(totalPages);
        } else if (currentPage >= totalPages - 2) {
            pageNumbers.push(1);
            pageNumbers.push('...');
            for (let i = totalPages - 4; i <= totalPages; i++) {
                pageNumbers.push(i);
            }
        } else {
            pageNumbers.push(1);
            pageNumbers.push('...');
            for (let i = currentPage - 1; i <= currentPage + 1; i++) {
                pageNumbers.push(i);
            }
            pageNumbers.push('...');
            pageNumbers.push(totalPages);
        }
    }

    const handleJumpToPage = (e) => {
        e.preventDefault();
        const pageNumber = parseInt(jumpToPage);
        if (pageNumber >= 1 && pageNumber <= totalPages) {
            paginate(pageNumber);
            setJumpToPage('');
        }
    };

    return (
        <div className="flex flex-col items-center mt-4 space-y-2">
            <div className="flex justify-center space-x-2">
                {pageNumbers.map((number, index) => (
                    <button
                        key={index}
                        onClick={() => number !== '...' && paginate(number)}
                        className={`px-3 py-1 rounded ${
                            currentPage === number 
                                ? 'bg-blue-500 text-white' 
                                : number === '...' 
                                    ? 'bg-gray-200 text-black cursor-default' 
                                    : 'bg-gray-200 text-black hover:bg-gray-300'
                        }`}
                        disabled={number === '...'}
                    >
                        {number}
                    </button>
                ))}
            </div>
            <form onSubmit={handleJumpToPage} className="flex items-center space-x-2">
                <input
                    type="number"
                    min="1"
                    max={totalPages}
                    value={jumpToPage}
                    onChange={(e) => setJumpToPage(e.target.value)}
                    className="w-16 px-2 py-1 text-sm border rounded text-black"
                    placeholder="Pagina"
                />
                <button 
                    type="submit"
                    className="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600"
                >
                    Vai
                </button>
            </form>
        </div>
    );
};

const [isLoading, setIsLoading] = React.useState(true);
const [isMenuCollapsed, setIsMenuCollapsed] = React.useState(false);
const [isPiPActive, setIsPiPActive] = React.useState(false);
const pipVideoRef = React.useRef(null);




    
 const handleCardClick = (card) => {
        setSelectedCard(card);
    };
    

    const handleCloseCardDetails = () => {
        setSelectedCard(null);
    };
     const handleEditCard = (card) => {
        setNewCard(card);
        setIsEditDialogOpen(true);
    };

if (isLoading) {
    return <Preloader />;
}
    
    return (
        <div className="container mx-auto p-4">
         <style jsx global>{`
                .grayscale {
                    filter: grayscale(100%);
                }
                .grayscale:hover {
                    filter: grayscale(0%);
                }
                
                 .text-shadow {
                    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                }
            `}</style>
         <div className="mb-6">
  {/* Selettore del tema - solo per mobile, in alto a destra */}
  <div className="flex justify-end mb-2 sm:hidden">
    <div className="flex items-center space-x-3">
        {/* Pulsanti rapidi Google per mobile */}
        <div className="flex items-center space-x-1">
            {isSignedIn ? (
                <div className="flex space-x-1">
                    <button 
                        onClick={loadFromGoogleSheets} 
                        className="px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                        title="Carica da Google Sheets"
                    >
                        üì•
                    </button>
                    <button 
                        onClick={saveToGoogleSheets} 
                        className="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                        title="Salva su Google Sheets"
                    >
                        üíæ
                    </button>
                </div>
            ) : (
                <button 
                    onClick={handleAuthClick} 
                    className="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
                    title="Accedi a Google"
                >
                    üîê
                </button>
            )}
        </div>
          {/* Toggle menu */}
        <button 
            onClick={() => setIsMenuCollapsed(!isMenuCollapsed)}
            className="px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
            title={isMenuCollapsed ? "Mostra menu" : "Nascondi menu"}
        >
            üíÄ
        </button>
        {/* Separatore visuale */}
        <div className={`w-px h-4 ${theme === 'standard' ? 'bg-white' : 'bg-pink-800'} opacity-50`}></div>
        {/* Selettore tema */}
        <div className="flex items-center">
            <label className={`mr-2 text-xs ${theme === 'standard' ? 'text-white' : 'text-pink-800'} text-shadow`}>Tema:</label>
            <select 
                value={theme} 
                onChange={toggleTheme}
                className="px-1 py-1 text-xs rounded text-black"
            >
                <option value="standard">Standard</option>
                <option value="pink">Rosa</option>
            </select>
        </div>
    </div>
</div>

  {/* Titolo e selettore del tema per desktop */}
  <div className="flex flex-col sm:flex-row justify-between items-center">
    <h1 className={`text-3xl font-bold ${theme === 'standard' ? 'text-white' : 'text-pink-800'} text-shadow text-center sm:text-left mb-2 sm:mb-0`}>
        OP CARD COLLECTION
    </h1>
    {/* Selettore del tema e pulsanti rapidi - solo per desktop */}
    <div className="hidden sm:flex items-center space-x-3">
        {/* Pulsanti rapidi Google */}
        <div className="flex items-center space-x-2">
            {isSignedIn ? (
                <div className="flex space-x-1">
                    <button 
                        onClick={loadFromGoogleSheets} 
                        className="px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                        title="Carica da Google Sheets"
                    >
                        üì•
                    </button>
                    <button 
                        onClick={saveToGoogleSheets} 
                        className="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                        title="Salva su Google Sheets"
                    >
                        üíæ
                    </button>
                </div>
            ) : (
                <button 
                    onClick={handleAuthClick} 
                    className="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
                    title="Accedi a Google"
                >
                    üîê
                </button>
            )}
        </div>
        <button 
        onClick={() => setIsMenuCollapsed(!isMenuCollapsed)}
        className="px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
        title={isMenuCollapsed ? "Mostra menu" : "Nascondi menu"}
    >
        üíÄ
    </button>
        
        {/* Separatore visuale */}
        <div className={`w-px h-4 ${theme === 'standard' ? 'bg-white' : 'bg-pink-800'} opacity-50`}></div>
        
        {/* Selettore del tema */}
        <div className="flex items-center">
            <label className={`mr-2 text-xs ${theme === 'standard' ? 'text-white' : 'text-pink-800'} text-shadow`}>Tema:</label>
            <select 
                value={theme} 
                onChange={toggleTheme}
                className="px-1 py-1 text-xs rounded text-black"
            >
                <option value="standard">Standard</option>
                <option value="pink">Rosa</option>
            </select>
        </div>
    </div>
</div>


<div className={`transition-all duration-500 ease-in-out ${isMenuCollapsed ? 'max-h-0 opacity-0 overflow-hidden' : 'max-h-96 opacity-100'}`}>
<div className="mt-2 mb-4 sm:hidden space-y-2">
  <button 
    onClick={toggleFullscreen}
    className="w-full px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors"
  >
    {isFullscreen ? 'Esci da Fullscreen' : 'Vai a Fullscreen'}
  </button>
  <button 
    onClick={togglePictureInPicture}
    className="w-full px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors"
  >
    üìå PiP Always-on-Top
  </button>
  <button 
    onClick={openPopupWindow}
    className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors"
  >
    ü™ü Finestra Popup
  </button>
</div>






<div className="grid grid-cols-3 gap-2 mb-4">
  <button 
    onClick={() => setUtilityPopupVisible(true)}
    className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
  >
    UTILITY
  </button>
  <button 
    onClick={() => setShopPopupVisible(true)}
    className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors"
  >
    SHOP
  </button>
  <button 
    onClick={() => setComingSoonPopupVisible(true)}
    className="w-full px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"
  >
    Coming Soon
  </button>
</div>

 
{utilityPopupVisible && (
<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]">
    <div className="bg-white p-6 rounded-lg w-full max-w-2xl">
      <h2 className="text-xl font-bold mb-4 text-black">Utility</h2>
      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          {/* Prima colonna */}
          <button 
            onClick={copyLinkToClipboard}
            className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors"
          >
            {linkCopied ? 'Link Copiato!' : 'Copia Link Collezione'}
          </button>
          <a 
            href="https://docs.google.com/spreadsheets/d/13fqpfjx91d6Ke99LVIofbTZr_goA8dQdmNUPTPjcDsQ/edit?gid=0#gid=0" 
            target="_blank" 
            rel="noopener noreferrer"
            className="block w-full px-4 py-2 bg-green-800 text-white rounded hover:bg-green-900 transition-colors text-center"
          >
            Gestionale
          </a>
          <a 
            href="https://www.cardmarket.com/it/OnePiece/Products/Singles?mode=gallery&idExpansion=0&idRarity=0&sortBy=price_desc&site=16" 
            target="_blank" 
            rel="noopener noreferrer"
            className="block w-full px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors text-center"
          >
            Card Market
          </a>
        </div>
<div className="space-y-2">
  {/* Seconda colonna */}
  <button 
    onClick={togglePrintDialog}
    className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors"
  >
    PRINT MISS
  </button>
  <button 
    onClick={togglePictureInPicture}
    className="w-full px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors"
  >
    üìå PiP Always-on-Top
  </button>
  <button 
    onClick={openPopupWindow}
    className="w-full px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors"
  >
    ü™ü Finestra Popup
  </button>
</div>
      </div>
      <button 
        onClick={() => setUtilityPopupVisible(false)}
        className="w-full mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
      >
        Chiudi
      </button>
    </div>
  </div>
)}

{shopPopupVisible && (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4">
    <div className="bg-white p-6 rounded-lg w-full max-w-md">
      <h2 className="text-xl font-bold mb-4 text-black">Cerca su Card Market</h2>
      <form onSubmit={handleShopSearch} className="space-y-4">
        <div>
          <label className="block mb-1 text-black font-medium">Nome Carta *</label>
          <input
            type="text"
            name="carta"
            value={shopFormData.carta}
            onChange={handleShopFormChange}
            className="w-full px-3 py-2 border rounded text-black"
            placeholder="Nome della carta"
            required
          />
        </div>
        <div>
          <label className="block mb-1 text-black font-medium">Set</label>
          <input
            type="text"
            name="set"
            value={shopFormData.set}
            onChange={handleShopFormChange}
            className="w-full px-3 py-2 border rounded text-black"
            placeholder="Set (opzionale)"
          />
        </div>
        <div>
          <label className="block mb-1 text-black font-medium">Numero</label>
          <input
            type="text"
            name="numero"
            value={shopFormData.numero}
            onChange={handleShopFormChange}
            className="w-full px-3 py-2 border rounded text-black"
            placeholder="Numero carta (opzionale)"
          />
        </div>
        <div className="flex space-x-2">
          <button 
            type="button"
            onClick={() => {
              resetShopForm();
              setShopPopupVisible(false);
            }}
            className="flex-1 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"
          >
            Annulla
          </button>
          <button 
            type="submit"
            className="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
          >
            Cerca
          </button>
        </div>
      </form>
    </div>
  </div>
)}

{comingSoonPopupVisible && (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]">
    <div className="bg-white p-6 rounded-lg">
      <h2 className="text-xl font-bold mb-4 text-black">Coming Soon</h2>
      <p className="text-black mb-4">Nuove funzionalit√† in arrivo!</p>
      <button 
        onClick={() => setComingSoonPopupVisible(false)}
        className="w-full px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
      >
        Chiudi
      </button>
    </div>
  </div>
)}

                  <div className="mb-4">
                  
                  
    <button 
        onClick={() => setIsMenuVisible(!isMenuVisible)}
        className="w-full px-4 py-2 bg-cyan-900 text-white rounded hover:bg-cyan-950 transition-colors mb-2"
    >
        {isMenuVisible ? 'Chiudi MENU' : 'Apri MENU'}
    </button>
    
    {isMenuVisible && (
        <div className="flex flex-wrap gap-2">
            <button 
                onClick={() => setIsFormVisible(!isFormVisible)}
                className={`px-4 py-2 ${theme === 'standard' ? 'bg-blue-500 hover:bg-blue-600' : 'bg-pink-500 hover:bg-pink-600'} text-white rounded transition-colors`}
            >
                {isFormVisible ? 'Nascondi Form' : 'Aggiungi (N)'}
            </button>
            <label className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors cursor-pointer">
                {loadedFileName ? 'Cambia File (L)' : 'Carica Excel (L)'}
                <input id="excelUpload" type="file" onChange={handleFileUpload} accept=".xlsx, .xls" className="hidden" />
            </label>
            <button 
                onClick={() => setIsExportDialogOpen(true)}
                className="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors"
            >
                Esporta in Excel
            </button>
  

            {loadedFileName && (
                <button 
                    onClick={handleFileEject}
                    className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                >
                    Espelli File
                </button>
            )}
            {isSignedIn ? (
                <div>
                    <button onClick={handleSignoutClick} className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors mr-2">
                        Sign Out da Google
                    </button>
                    <button onClick={saveToGoogleSheets} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors mr-2">
                        Salva su Google Sheets
                    </button>
                    <button onClick={loadFromGoogleSheets} className="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors">
                        Carica da Google Sheets
                    </button>
                </div>
            ) : (
                <button onClick={handleAuthClick} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                    Sign In con Google
                </button>
            )}
            <button 
                onClick={clearCache}
                className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors"
            >
                Cancella Cache
            </button>
        </div>
    )}
</div>
</div>
</div>
                    
                   
                    {loadedFileName && (
                        <p className="mb-4 text-white">File caricato: {loadedFileName}</p>
                    )}
                  {isFormVisible && (
                        <div className="bg-gray-800 shadow rounded-lg p-6 mb-6">
                            <h2 className="text-xl font-semibold mb-4 text-white">Aggiungi Nuova Carta</h2>
                            <CardForm 
                                card={newCard}
                onInputChange={handleInputChange}
                onImageChange={handleImageChange}
                onSubmit={addOrUpdateCard}
                onAddCustomSet={addCustomSet}
                setOptions={setOptions}
                onCancel={() => {
setNewCard({
    id: null,
    name: '',
    set: '',
    cardNumber: '',
    version: '',
    language: 'ENG',
    image: null,
    color: '',
    notes: '',
    special: false,
    favorite: false,
    isDon: false,
    ogSet: '',
    ogCardNumber: ''
});
                    setIsFormVisible(false);
                }}
                            />
                        </div>
                    )}
                      <div className="mb-4">
                <input
                    type="text"
                    placeholder="Cerca carta per nome o numero..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full px-3 py-2 border rounded text-black mb-2"
                />
<div className="flex items-center space-x-4 flex-wrap">
    <div className="flex items-center">
        <input
            type="checkbox"
            id="showSpecialOnly"
            checked={showSpecialOnly}
            onChange={(e) => setShowSpecialOnly(e.target.checked)}
            className="mr-2"
        />
        <label htmlFor="showSpecialOnly" className="text-white">
            Special
        </label>
    </div>
    <div className="flex items-center">
        <input
            type="checkbox"
            id="showFavoritesOnly"
            checked={showFavoritesOnly}
            onChange={(e) => setShowFavoritesOnly(e.target.checked)}
            className="mr-2"
        />
        <label htmlFor="showFavoritesOnly" className="text-white flex items-center">
            Preferiti <span className="ml-1">‚≠ê</span>
        </label>
    </div>
</div>


            </div>
<div className="mb-4 flex justify-between items-center">
    <div className="flex items-center space-x-2">
        <span className={`text-sm ${theme === 'standard' ? 'text-white' : 'text-pink-800'}`}>Vista:</span>
        <button
            onClick={() => setViewMode('grid')}
            className={`px-3 py-1 rounded text-sm ${
                viewMode === 'grid' 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-gray-200 text-black hover:bg-gray-300'
            }`}
        >
            Griglia
        </button>
        <button
            onClick={() => setViewMode('list')}
            className={`px-3 py-1 rounded text-sm ${
                viewMode === 'list' 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-gray-200 text-black hover:bg-gray-300'
            }`}
        >
            Elenco
        </button>
    </div>
</div>


            
             <div className="mb-6 pt-4 border-2 border-t-amber-400 border-r-0 border-l-0 border-b-0"> {/* Aumentato il margine inferiore */}
                <div className="overflow-x-auto scrolling-touch mb-2 pb-2"> {/* Aggiunto margine inferiore */}
                    <div className="flex whitespace-nowrap">
                        {initialSetOptions.map((set) => (
                            <button
                                key={set}
                                onClick={() => setActiveSet(set)}
                                className={`mr-2 px-3 py-1 rounded flex-shrink-0 ${activeSet === set ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'}`}
                            >
                                {set}
                            </button>
                        ))}
                    </div>
                </div>
               
            </div>

            {/* Griglia delle carte */}
      {viewMode === 'grid' ? (
    <CardGrid 
        cards={currentCards} 
        onCardClick={handleCardClick}
        onEditCard={handleEditCard}
        onDeleteCard={deleteCard}
    />
) : (
    <CardList 
        cards={currentCards} 
        onCardClick={handleCardClick}
        onEditCard={handleEditCard}
        onDeleteCard={deleteCard}
    />
)}
            <Pagination currentPage={currentPage} totalPages={totalPages} paginate={paginate} />
            {selectedCard && (
                <CardDetails card={selectedCard} onClose={handleCloseCardDetails} />
            )}
            
   {isEditDialogOpen && (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={(e) => {
        if (e.target === e.currentTarget) {
            setIsEditDialogOpen(false);
        }
    }}>
        <div className="bg-gray-900 p-6 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
            <div className="flex justify-between items-center mb-4">
                <h2 className="text-2xl font-bold text-white">Modifica Carta</h2>
                <button 
                    onClick={() => setIsEditDialogOpen(false)}
                    className="text-white hover:text-gray-300 text-2xl font-bold"
                >
                    √ó
                </button>
            </div>
            <CardForm 
                card={newCard} 
                onInputChange={handleInputChange}
                onImageChange={handleImageChange}
                onSubmit={addOrUpdateCard}
                onAddCustomSet={addCustomSet}
                setOptions={setOptions}
                onCancel={() => setIsEditDialogOpen(false)} 
            />
        </div>
    </div>
)}
                    <ExportDialog
                        isOpen={isExportDialogOpen}
                        onClose={() => setIsExportDialogOpen(false)}
                        onExport={handleExcelExport}
                    />
                    
                    <PrintDialog
    isOpen={isPrintDialogOpen}
    onClose={togglePrintDialog}
    sets={setOptions}
    selectedSets={selectedSetsToPrint}
    onSetToggle={handleSetSelection}
    onPrint={() => {
        handlePrint();
        togglePrintDialog();
    }}
/>

                </div>
            );
        };
        
        const getColorName = (colorValue) => {
    const colorOption = colorOptions.find(c => c.value === colorValue);
    return colorOption ? colorOption.name : colorValue.replace('bg-', '');
};
        
   const CardDetails = ({ card, onClose }) => {
    const handleOutsideClick = (e) => {
        if (e.target === e.currentTarget) {
            onClose();
        }
    };

    const handleMarketSearch = () => {
        const searchQuery = `${card.name} ${card.set} ${card.cardNumber} cardmarket`;
        const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
        window.open(googleSearchUrl, '_blank');
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={handleOutsideClick}>
            <div className="bg-gray-800 p-6 rounded-lg w-full max-w-xs border-2 border-gray-300">
                <h2 className="text-xl font-bold mb-4 text-white">{card.name}</h2>
               <div className="grid grid-cols-2 gap-2 mb-4 text-sm">
    <p><span className="font-bold">Set:</span> {card.set}</p>
    <p><span className="font-bold">Numero:</span> {card.cardNumber}</p>
    <p><span className="font-bold">Versione:</span> {card.version}</p>
    <p><span className="font-bold">Lingua:</span> {card.language}</p>
    <p><span className="font-bold">Colore:</span> {getColorName(card.color)}</p>
    <p><span className="font-bold">Special:</span> {card.special ? 'S√¨' : 'No'}</p>
<p><span className="font-bold">Preferito:</span> {card.favorite ? '‚≠ê' : 'No'}</p>
    <p><span className="font-bold">DON!!:</span> {card.isDon ? 'S√¨' : 'No'}</p>
    {card.ogSet && <p><span className="font-bold">Set Originale:</span> {card.ogSet}</p>}
    {card.ogCardNumber && <p><span className="font-bold">Numero Originale:</span> {card.ogCardNumber}</p>}
</div>
                {card.notes && (
                    <div className="mb-4">
                        <h3 className="text-lg font-semibold mb-2 text-white">Note:</h3>
                        <p className="text-white text-sm">{card.notes}</p>
                    </div>
                )}
                {card.image && (
                    <img src={card.image} alt={card.name} className="max-w-full h-auto mb-4" />
                )}
                <div className="flex space-x-2">
                    <button onClick={onClose} className="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                        Chiudi
                    </button>
                    <button onClick={handleMarketSearch} className="flex-1 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                        Cerca su Market
                    </button>
                </div>
            </div>
        </div>
    );
};

        ReactDOM.render(<CardCollectionApp />, document.getElementById('root'));
    </script>
</body>
</html>
